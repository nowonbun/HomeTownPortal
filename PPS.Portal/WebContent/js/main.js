var app=angular.module("app",["ngRoute","ngSanitize"]);app.config(["$routeProvider","$qProvider",function(e,o){e.when("/",{controller:"main",templateUrl:"./views/main.tpl.jsp"}).when("/cardmastersetting",{controller:"cardmastersetting",templateUrl:"./views/cardmastersetting.tpl.jsp"}).when("/cardviewrole",{controller:"cardviewrole",templateUrl:"./views/rolelist.tpl.jsp"}).when("/actionrole",{controller:"actionrole",templateUrl:"./views/rolelist.tpl.jsp"}).when("/comgroupsetting",{controller:"comgroupsetting",templateUrl:"./views/comgroupsetting.tpl.jsp"}).when("/usermanagement",{controller:"usermanagement",templateUrl:"./views/usermanagement.tpl.jsp"}).otherwise({redirectTo:"/"})}]),app.directive("navigation",function(){return{restrict:"A",template:"<li ng-repeat='n in navi'><a ng-click='menu(n.menu,n.control,n.template,n.href);'>{{n.name}}</a></li>"}}),app.directive("loader",function(){return{restrict:"A",template:"<div class='loader'></div>"}}),app.filter("trusted",["$sce",function(o){return function(e){return o.trustAsHtml(e)}}]),app.controller("actionrole",["$scope","_ws","_loader","_table","_extendModal",function(n,e,r,a,o){r.controller.hide(),n.title="Action role",e.send("actionrole","init",null,function(e){var o=a({element:"#tablelist",url:JSON.parse(e).data,columns:["code","name"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(_notification("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("code")[0],n.selectname=e.rows(o).data().pluck("name")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null,n.selectname=null}});n.reloadTable=function(){o.ajax.reload()},r.controller.show()}),n.roleedit=function(){o.mainModal("./views/roleedit.tpl.jsp","actionroleedit",n)}}]),app.controller("actionroleedit",["$scope","_ws","_loader","$http","_extendModal","_notification","$timeout",function(r,i,n,e,a,s,l){function c(e){var o=$("<select></select>").addClass("browser-default").addClass(e);return o.append(d(0,"ALL")),o}function d(e,o){return $("<option></option>").prop("value",e).text(o)}function u(){return $("<div></div>").addClass("col-sm-12 col-md-6 col-lg-3")}function p(e){return e<$("#tableList").children().length?$($("#tableList").children()[e]):(r.addRow(!0),$($("#tableList").children()[$("#tableList").children().length-1]))}n.controller.hide(),r.title="Action view role edit",r.setValue=function(e,o,n,r){null===o&&(o=0),null===n&&(n=0),null===r&&(r=0),i.send("actionrole","getCompany",JSON.stringify({key:null,val:o,idx:e}),function(e){var o=JSON.parse(e),n=p(o.data3);n.find(".company-select").children().remove();var r=o.data2,a=n.find(".company-select");a.append(d(0,"ALL"));for(var t=0;t<r.length;t++)a.append(d(r[t].value,r[t].name));a.val(o.data)}),i.send("actionrole","getGroup",JSON.stringify({key:o,val:n,idx:e}),function(e){var o=JSON.parse(e),n=p(o.data3);n.find(".group-select").children().remove();var r=o.data2,a=n.find(".group-select");a.append(d(0,"ALL"));for(var t=0;t<r.length;t++)a.append(d(r[t].value,r[t].name));a.val(o.data)}),i.send("actionrole","getUser",JSON.stringify({key:n,val:r,idx:e}),function(e){var o=JSON.parse(e),n=p(o.data3);n.find(".user-select").children().remove();var r=o.data2,a=n.find(".user-select");a.append(d(0,"ALL"));for(var t=0;t<r.length;t++)a.append(d(r[t].value,r[t].name));a.val(o.data)})},r.addRow=function(e){var r=c("company-select");i.send("actionrole","getCompany",JSON.stringify({}),function(e){for(var o=JSON.parse(e).data2,n=0;n<o.length;n++)r.append(d(o[n].value,o[n].name))}),r.on("change",function(){var a=$(this);i.send("cardviewrole","getGroup",JSON.stringify({key:Number(a.val())}),function(e){var o=a.parent().parent().find(".group-select");o.children().remove();var n=JSON.parse(e).data2;o.append(d(0,"ALL"));for(var r=0;r<n.length;r++)o.append(d(n[r].value,n[r].name))})});var o=c("group-select");o.on("change",function(){var a=$(this);i.send("cardviewrole","getUser",JSON.stringify({key:Number(a.val())}),function(e){var o=a.parent().parent().find(".user-select");o.children().remove();var n=JSON.parse(e).data2;o.append(d(0,"ALL"));for(var r=0;r<n.length;r++)o.append(d(n[r].value,n[r].name))})});var n=c("user-select"),a=$("<div></div>").addClass("row grid-table").css("margin","0px");if(a.append(u().append(r)),a.append(u().append(o)),a.append(u().append(n)),e){var t=$("<button></button>").addClass("btn btn-danger custom-button row-button").text("Delete");t.on("click",function(){$(this).parent().parent().remove()}),a.append(u().append(t))}$("#tableList").append(a)},r.roleSave=function(){var t=[];function e(e,o,n){for(var r=0;r<t.length;r++)if(r!==n&&t[r].com===e&&("0"===t[r].grp||t[r].grp===o))return!1;return!0}function o(e,o,n,r){for(var a=0;a<t.length;a++)if(a!==r&&t[a].com===e&&t[a].grp===o&&("0"===t[a].usr||t[a].usr===n))return!1;return!0}if($(".company-select").each(function(){t.push({com:$(this).val(),grp:$(this).parent().parent().find(".group-select").val(),usr:$(this).parent().parent().find(".user-select").val()})}),1<t.length)for(var n=0;n<t.length;n++){if("0"===t[n].com)return s("danger","The role expression is incorrect."),$($("#tableList").children()[n]).addClass("error-row"),void l(function(){$("#tableList").children().each(function(){$(this).removeClass("error-row")})},3e3,!0);if(!e(t[n].com,t[n].grp,n))return s("danger","The role expression is incorrect."),$($("#tableList").children()[n]).addClass("error-row"),void l(function(){$("#tableList").children().each(function(){$(this).removeClass("error-row")})},3e3,!0);if(!o(t[n].com,t[n].grp,t[n].usr,n))return s("danger","The role expression is incorrect."),$($("#tableList").children()[n]).addClass("error-row"),void l(function(){$("#tableList").children().each(function(){$(this).removeClass("error-row")})},3e3,!0)}i.send("actionrole","saveRole",JSON.stringify({key:r.selectid,data:t}),function(e){var o=JSON.parse(e);s(o.type,o.msg),"success"===o.type&&(r.reloadTable(),$("#roleEditModal").modal("hide"))})},r.addRow(!1),i.send("actionrole","editRole",r.selectid,function(e){var o=JSON.parse(e);n.ready(function(){for(var e=0;e<o.length;e++)r.setValue(e,o[e].company,o[e].group,o[e].user);$("#roleEditModal").modal("show"),$("#roleEditModal").on("hidden.bs.modal",function(){a.mainModal()})}),n.controller.show()})}]),app.controller("admin",["$scope","_ws","_loader",function(o,e,n){n.show(),e.send("admin","init",null,function(e){o.cards=JSON.parse(e),n.hide()})}]),app.controller("card",["$scope","_ws","_loader",function(o,e,n){n.show(),e.send("card","init",null,function(e){o.cards=JSON.parse(e),n.hide()})}]),app.controller("cardmaster",["$scope","_ws","_loader","_safeApply","_filereader","_util","_extendModal","_notification",function(r,o,a,t,n,i,s,l){a.controller.hide(),o.send("cardmastersetting","initEdit",r.selectid,function(e){function o(){"IMC"===r.cardtype||"IMG"===r.cardtype?(r.isImageType=!0,r.isEventType=!1):"EMC"===r.cardtype||"EVT"===r.cardtype?(r.isImageType=!1,r.isEventType=!0):(r.isImageType=!1,r.isEventType=!1)}var n=JSON.parse(e);r.code=n.code,null!==r.code&&$("#code_label").addClass("active"),r.step=n.step,null!==r.step&&$("#step_label").addClass("active"),r.controller=n.controller,null!==r.controller&&$("#controler_label").addClass("active"),r.template=n.template,null!==r.template&&$("#template_label").addClass("active"),r.name=n.name,null!==r.name&&$("#name_label").addClass("active"),r.sequence=n.seq,null!==r.sequence&&$("#sequence_label").addClass("active"),r.description=n.description,null!==r.description&&$("#description_label").addClass("active"),r.cardtypeList=n.cardtypelist,r.cardtype=n.type,o(),$(document).off("change","#cardtype").on("change","#cardtype",function(){t(function(){r.cardtype=$("#cardtype").val(),o()})}),null==n.img?r.img_url=CONTENTS+"no_card.jpg":r.img_url=n.img,r.title=n.title,null!==r.title&&$("#title_label").addClass("active"),r.icon=n.icon,null!==r.icon&&$("#icon_label").addClass("active"),r.color=n.color,null!==r.color&&$("#color_label").addClass("active"),a.ready(function(){$("#cardtype").val(n.type),$(".mdb-select").material_select(),$("#cardMasterModal").modal("show"),$("#cardMasterModal").on("hidden.bs.modal",function(){s.mainModal()})}),a.controller.show()}),r.fileupload=function(){var e=n.getFile($("#img_file"));e.size>CARD_FILE_SIZE_LIMIT?l("danger","The file maximum size has been exceeded. max-size : 60KB"):n.readFile(e,function(e){r.img_url=e.binary})},r.apply=function(){if(i.validateInput(r.name,"#name","Name")&&i.validateInput(r.sequence,"#sequence","Sequence")){r.sequence=util.parseInt(r.sequence),r.img_url==CONTENTS+"no_card.jpg"&&(r.img_url=null);var e={code:r.code,name:r.name,seq:r.sequence,type:r.cardtype,title:r.title,icon:r.icon,color:r.color,img:r.img_url};a.show(),o.send("cardmastersetting","applyEdit",JSON.stringify(e),function(e){var o=JSON.parse(e);a.hide(),l(o.type,o.msg),r.reloadTable(),$("#cardMasterModal").modal("hide")})}}}]),app.controller("cardmastersetting",["$scope","_ws","_loader","_safeApply","_extendModal","_notification","_table",function(n,e,r,o,a,t,i){r.controller.hide(),e.send("cardmastersetting","init",null,function(e){var o=i({element:"#tablelist",url:JSON.parse(e).data,columns:["code","name","title","description","hasImg","icon","color","type","step","seq"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(t("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("code")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),n.selectid=null}});n.cardEdit=function(){a.mainModal("./views/cardmaster.tpl.jsp","cardmaster",n)},n.reloadTable=function(){o.ajax.reload()},r.controller.show()})}]),app.controller("cardviewrole",["$scope","_ws","_loader","_table","_extendModal",function(n,e,r,a,t){r.controller.hide(),n.title="View role",e.send("cardviewrole","init",null,function(e){var o=a({element:"#tablelist",url:JSON.parse(e).data,columns:["code","name"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(_notification("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("code")[0],n.selectname=e.rows(o).data().pluck("name")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null,n.selectname=null}});n.roleedit=function(){t.mainModal("./views/roleedit.tpl.jsp","cardviewroleedit",n)},n.reloadTable=function(){o.ajax.reload()},r.controller.show()})}]),app.controller("cardviewroleedit",["$scope","_ws","_loader","$http","_extendModal","_notification","$timeout",function(r,i,n,e,a,s,l){function c(e){var o=$("<select></select>").addClass("browser-default").addClass(e);return o.append(d(0,"ALL")),o}function d(e,o){return $("<option></option>").prop("value",e).text(o)}function u(){return $("<div></div>").addClass("col-sm-12 col-md-6 col-lg-3")}function p(e){return e<$("#tableList").children().length?$($("#tableList").children()[e]):(r.addRow(!0),$($("#tableList").children()[$("#tableList").children().length-1]))}n.controller.hide(),r.title="Card view role edit",r.setValue=function(e,o,n,r){null===o&&(o=0),null===n&&(n=0),null===r&&(r=0),i.send("cardviewrole","getCompany",JSON.stringify({key:null,val:o,idx:e}),function(e){var o=JSON.parse(e),n=p(o.data3);n.find(".company-select").children().remove();var r=o.data2,a=n.find(".company-select");a.append(d(0,"ALL"));for(var t=0;t<r.length;t++)a.append(d(r[t].value,r[t].name));a.val(o.data)}),i.send("cardviewrole","getGroup",JSON.stringify({key:o,val:n,idx:e}),function(e){var o=JSON.parse(e),n=p(o.data3);n.find(".group-select").children().remove();var r=o.data2,a=n.find(".group-select");a.append(d(0,"ALL"));for(var t=0;t<r.length;t++)a.append(d(r[t].value,r[t].name));a.val(o.data)}),i.send("cardviewrole","getUser",JSON.stringify({key:n,val:r,idx:e}),function(e){var o=JSON.parse(e),n=p(o.data3);n.find(".user-select").children().remove();var r=o.data2,a=n.find(".user-select");a.append(d(0,"ALL"));for(var t=0;t<r.length;t++)a.append(d(r[t].value,r[t].name));a.val(o.data)})},r.addRow=function(e){var r=c("company-select");i.send("cardviewrole","getCompany",JSON.stringify({}),function(e){for(var o=JSON.parse(e).data2,n=0;n<o.length;n++)r.append(d(o[n].value,o[n].name))}),r.on("change",function(){var a=$(this);i.send("cardviewrole","getGroup",JSON.stringify({key:Number(a.val())}),function(e){var o=a.parent().parent().find(".group-select");o.children().remove();var n=JSON.parse(e).data2;o.append(d(0,"ALL"));for(var r=0;r<n.length;r++)o.append(d(n[r].value,n[r].name))})});var o=c("group-select");o.on("change",function(){var a=$(this);i.send("cardviewrole","getUser",JSON.stringify({key:Number(a.val())}),function(e){var o=a.parent().parent().find(".user-select");o.children().remove();var n=JSON.parse(e).data2;o.append(d(0,"ALL"));for(var r=0;r<n.length;r++)o.append(d(n[r].value,n[r].name))})});var n=c("user-select"),a=$("<div></div>").addClass("row grid-table").css("margin","0px");if(a.append(u().append(r)),a.append(u().append(o)),a.append(u().append(n)),e){var t=$("<button></button>").addClass("btn btn-danger custom-button row-button").text("Delete");t.on("click",function(){$(this).parent().parent().remove()}),a.append(u().append(t))}$("#tableList").append(a)},r.roleSave=function(){var t=[];function e(e,o,n){for(var r=0;r<t.length;r++)if(r!==n&&t[r].com===e&&("0"===t[r].grp||t[r].grp===o))return!1;return!0}function o(e,o,n,r){for(var a=0;a<t.length;a++)if(a!==r&&t[a].com===e&&t[a].grp===o&&("0"===t[a].usr||t[a].usr===n))return!1;return!0}if($(".company-select").each(function(){t.push({com:$(this).val(),grp:$(this).parent().parent().find(".group-select").val(),usr:$(this).parent().parent().find(".user-select").val()})}),1<t.length)for(var n=0;n<t.length;n++){if("0"===t[n].com)return s("danger","The role expression is incorrect."),$($("#tableList").children()[n]).addClass("error-row"),void l(function(){$("#tableList").children().each(function(){$(this).removeClass("error-row")})},3e3,!0);if(!e(t[n].com,t[n].grp,n))return s("danger","The role expression is incorrect."),$($("#tableList").children()[n]).addClass("error-row"),void l(function(){$("#tableList").children().each(function(){$(this).removeClass("error-row")})},3e3,!0);if(!o(t[n].com,t[n].grp,t[n].usr,n))return s("danger","The role expression is incorrect."),$($("#tableList").children()[n]).addClass("error-row"),void l(function(){$("#tableList").children().each(function(){$(this).removeClass("error-row")})},3e3,!0)}i.send("cardviewrole","saveRole",JSON.stringify({key:r.selectid,data:t}),function(e){var o=JSON.parse(e);s(o.type,o.msg),"success"===o.type&&(r.reloadTable(),$("#roleEditModal").modal("hide"))})},r.addRow(!1),i.send("cardviewrole","editRole",r.selectid,function(e){var o=JSON.parse(e);n.ready(function(){for(var e=0;e<o.length;e++)r.setValue(e,o[e].company,o[e].group,o[e].user);$("#roleEditModal").modal("show"),$("#roleEditModal").on("hidden.bs.modal",function(){a.mainModal()})}),n.controller.show()})}]),app.controller("comgroupadd",["$scope","_ws","_loader","_extendModal","_safeApply","_notification",function(n,o,r,a,t,i){function s(e,o){if(null==e)return null;for(var n=0;n<e.length;n++)if(e[n].value===o)return e[n].name;return null}function l(e,o){if(null==e)return!1;for(var n=0;n<e.length;n++)if(e[n].name===o)return!0;return!1}r.show(),n.applyView=!0,n.dataCheck=function(e){e&&l(n.companyList,n.companyIn)&&(r.show(),o.send("comgroupsetting","getGroup",function(e,o){if(null==e)return null;for(var n=0;n<e.length;n++)if(e[n].name===o)return e[n].value;return null}(n.companyList,n.companyIn),function(e){var o=JSON.parse(e);n.groupList=o,$(document).off("change","#group").on("change","#group",function(){t(function(){n.group=$("#group").val(),n.groupIn=s(n.groupList,$("#group").val()),n.dataCheck(!1)})}),r.ready(function(){$(".mdb-select").material_select("destroy"),$(".mdb-select").material_select(),r.hide()})})),""===$.trim(n.companyIn)?n.applyView=!0:""===$.trim(n.groupIn)?n.applyView=!0:l(n.companyList,n.companyIn)&&l(n.groupList,n.groupIn)?n.applyView=!0:n.applyView=!1},n.apply=function(){return""===$.trim(n.companyIn)?(i("danger","Please input the text of company.",function(){$("#companyIn").removeClass("error-focus")}),void $("#companyIn").addClass("error-focus")):""===$.trim(n.groupIn)?(i("danger","Please input the text of group.",function(){$("#groupIn").removeClass("error-focus")}),void $("#groupIn").addClass("error-focus")):(r.show(),void o.send("comgroupsetting","applyAdd",JSON.stringify({company:n.companyIn,group:n.groupIn}),function(e){var o=JSON.parse(e);r.hide(),i(o.type,o.msg),"success"===o.type&&(n.reloadTable(),$("#comgroupModal").modal("hide"))}))},o.send("comgroupsetting","initAdd",null,function(e){var o=JSON.parse(e);n.companyList=o,$(document).off("change","#company").on("change","#company",function(){t(function(){n.company=$("#company").val(),n.companyIn=s(n.companyList,$("#company").val()),n.dataCheck(!0)})}),r.ready(function(){$(".mdb-select").material_select(),$("#comgroupModal").modal("show"),$("#comgroupModal").on("hidden.bs.modal",function(){a.mainModal()}),r.hide()})})}]),app.controller("comgroupedit",["$scope","_ws","_loader","_extendModal","_safeApply","_notification",function(n,e,r,a,o,t){r.show(),e.send("comgroupsetting","initEdit",n.selectid,function(e){var o=JSON.parse(e);n.companyIn=o.name,n.groupIn=o.groupname,n.editView=!0,r.ready(function(){$("#companyIn_label").addClass("active"),$("#groupIn_label").addClass("active"),$("#comgroupModal").modal("show"),$("#comgroupModal").on("hidden.bs.modal",function(){a.mainModal()}),r.hide()})}),n.edit=function(){return""===$.trim(n.companyIn)?(t("danger","Please input the text of company.",function(){$("#companyIn").removeClass("error-focus")}),void $("#companyIn").addClass("error-focus")):""===$.trim(n.groupIn)?(t("danger","Please input the text of group.",function(){$("#groupIn").removeClass("error-focus")}),void $("#groupIn").addClass("error-focus")):(r.show(),void e.send("comgroupsetting","applyEdit",JSON.stringify({id:n.selectid,company:n.companyIn,group:n.groupIn}),function(e){var o=JSON.parse(e);r.hide(),t(o.type,o.msg),"success"===o.type&&(n.reloadTable(),$("#comgroupModal").modal("hide"))}))}}]),app.controller("comgroupsetting",["$scope","_ws","_loader","_safeApply","_extendModal","_notification","_table",function(n,r,a,e,t,i,s){a.controller.hide(),r.send("comgroupsetting","init",null,function(e){var o=s({element:"#tablelist",url:JSON.parse(e).data,columns:["id","name","groupname","active"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(i("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("id")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null}});n.userAdd=function(){t.mainModal("./views/comgroupadd.tpl.jsp","comgroupadd",n)},n.userEdit=function(){t.mainModal("./views/comgroupedit.tpl.jsp","comgroupedit",n)},n.userDelete=function(){a.show(),r.send("comgroupsetting","delete",n.selectid,function(e){var o=JSON.parse(e);a.hide(),i(o.type,o.msg),n.reloadTable(),$("#deleteModal").modal("hide")})},n.reloadTable=function(){o.ajax.reload()},a.controller.show()})}]),app.controller("datamastersetting",["$scope","_ws","_loader","_notification",function(o,e,n,r){n.show(),e.send("datamastersetting","init",null,function(e){o.cards=JSON.parse(e),n.hide()})}]),app.controller("main",["$scope","_ws","_loader",function(e,o,n){n.controller.hide(),o.send("main","init",null,function(e){n.controller.show()})}]),app.controller("navigate",["$scope","_ws",function(o,e){e.message("navigate","init",function(e){o.navi=JSON.parse(e)})}]),app.controller("profile",["$scope","_ws","_notification","_filereader","_loader","_safeApply","_extendModal",function(n,r,a,o,t,i,s){t.controller.hide(),n.title="Profile",n.canUserId=!1,r.send("profile","init",null,function(e){var o=JSON.parse(e);n.given_name=o.given_name,null!==n.given_name&&$("#given_name_label").addClass("active"),n.name=o.name,null!==n.name&&$("#name_label").addClass("active"),n.nick_name=o.nick_name,null!==n.nick_name&&$("#nick_name_label").addClass("active"),null==o.img_blob?n.img_blob=CONTENTS+"no_photo.png":n.img_blob=o.img_blob,n.canCorrentPassword=o.canModifyPassword,n.canModifyPassword=o.canModifyPassword,n.canModifyCompany=o.canModifyCompany,o.canModifyCompany&&(n.companyList=o.companyList,n.company=o.company,$(document).off("change","#company").on("change","#company",function(){i(function(){n.company=$("#company").val()}),n.canModifyGroup&&r.send("profile","getGroup",JSON.stringify({key:Number(n.company)}),function(e){var o=JSON.parse(e);n.groupList=o.data,t.ready(function(){$(".mdb-select").material_select("destroy"),$(".mdb-select").material_select()})})})),n.canModifyGroup=o.canModifyGroup,o.canModifyGroup&&(n.groupList=o.groupList,n.group=o.group,$(document).off("change","#group").on("change","#group",function(){i(function(){n.group=$("#group").val()})})),t.ready(function(){o.canModifyCompany&&$("#company").val(o.company),o.canModifyGroup&&$("#group").val(o.group),$(".mdb-select").material_select(),$("#profileModal").modal("show"),$("#profileModal").on("hidden.bs.modal",function(){s.mainModal()})}),t.controller.show()}),n.fileupload=function(){var e=o.getFile($("#img_file"));e.size>CARD_FILE_SIZE_LIMIT?a("danger","The file maximum size has been exceeded. max-size : 60KB"):o.readFile(e,function(e){n.img_blob=e.binary})},n.checkPassword=function(){if($.trim(n.password)!==$.trim(n.password_confirm))return n.isPasswordError=!0,$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");n.isPasswordError=!1,$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")},n.apply=function(){if(""===$.trim(n.given_name))return a("danger","Please input the text of 'Given name'",function(){$("#given_name").removeClass("error-focus")}),void $("#given_name").addClass("error-focus");if($("#given_name").removeClass("error-focus"),""===$.trim(n.name))return a("danger","Please input the text of 'name'",function(){$("#name").removeClass("error-focus")}),void $("#name").addClass("error-focus");if($("#name").removeClass("error-focus"),""===$.trim(n.nick_name))return a("danger","Please input the text of 'Nick name'",function(){$("#nick_name").removeClass("error-focus")}),void $("#nick_name").addClass("error-focus");if($("#nick_name").removeClass("error-focus"),n.canModifyPassword){var e=!0;if(""===$.trim(n.current_password)&&(e=!1),""===$.trim(n.password)&&e)return a("danger","Please input the text of 'Password'",function(){$("#password").removeClass("error-focus")}),void $("#password").addClass("error-focus");if($("#password").removeClass("error-focus"),""===$.trim(n.password_confirm)&&e)return a("danger","Please input the text of 'Password confirm'",function(){$("#password_confirm").removeClass("error-focus")}),void $("#password_confirm").addClass("error-focus");if($("#password_confirm").removeClass("error-focus"),$.trim(n.password)!==$.trim(n.password_confirm)&&e)return a("danger","Please input the text of 'Password is incorrect'",function(){$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}),$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}if(n.canModifyCompany){if(""===$.trim(n.company))return a("danger","Please select the value of 'company'",function(){$("#company").removeClass("error-focus")}),void $("#company").addClass("error-focus");$("#company").removeClass("error-focus")}if(n.canModifyGroup){if(""===$.trim(n.group))return a("danger","Please select the value of 'group'",function(){$("#group").removeClass("error-focus")}),void $("#group").addClass("error-focus");$("#group").removeClass("error-focus")}0<n.img_blob.indexOf("no_photo.png")&&(n.img_blob=null);var o={given_name:n.given_name,name:n.name,nick_name:n.nick_name,img_blob:n.img_blob,current_password:n.current_password,password:n.password,company:n.company,group:n.group};t.show(),r.send("profile","apply",JSON.stringify(o),function(e){var o=JSON.parse(e);t.hide(),a(o.type,o.msg),"success"===o.type&&$("#profileModal").modal("hide")})}}]),app.run(["$rootScope","_ws","_loader","_notification","_extendModal","$timeout","$http","$compile",function(e,o,n,r,a,t,i,s){o.message("login","init",function(e){"NG"===e&&(location.href="./Logout")}),o.message("login","permission",function(e){var o=JSON.parse(e);r(o.type,o.msg),location.href="./#!/"}),o.open(function(){}),o.close(function(){r("danger","The Websocket connection was lost."),t(function(){r("danger","It's reloading Now."),location.reload()},1e3,!0)}),e.profileEdit=function(){$("#navitoggler").click(),a.mainModal("./views/profile.tpl.jsp","profile",null,null)},e.menu=function(e,o,n,r){if(!e)return $(".menu-backdrop").click(),void(location.href=r);a.menuModal(n,o)}}]),app.controller("useradd",["$scope","_ws","_loader","_filereader","_safeApply","_notification","_extendModal",function(n,r,a,o,t,i,s){a.controller.hide(),n.title="User Management",n.canUserId=!0,n.canCorrentPassword=!1,n.canModifyPassword=!0,n.canModifyCompany=!0,n.canModifyGroup=!0,n.existID=!1,r.send("usermanagement","initAdd",null,function(e){var o=JSON.parse(e);n.img_blob=CONTENTS+"no_photo.png",n.companyList=o.companyList,$(document).off("change","#company").on("change","#company",function(){t(function(){n.company=$("#company").val()}),r.send("usermanagement","getGroup",JSON.stringify({key:Number(n.company)}),function(e){var o=JSON.parse(e);n.groupList=o.data,a.ready(function(){$(".mdb-select").material_select("destroy"),$(".mdb-select").material_select()})})}),n.groupList=o.groupList,$(document).off("change","#group").on("change","#group",function(){t(function(){n.group=$("#group").val()})}),a.ready(function(){$(".mdb-select").material_select(),$("#profileModal").modal("show"),$("#profileModal").on("hidden.bs.modal",function(){s.mainModal()})}),a.controller.show()}),n.fileupload=function(){var e=o.getFile($("#img_file"));e.size>CARD_FILE_SIZE_LIMIT?i("danger","The file maximum size has been exceeded. max-size : 60KB"):o.readFile(e,function(e){n.img_blob=e.binary})},n.checkPassword=function(){if($.trim(n.password)!==$.trim(n.password_confirm))return n.isPasswordError=!0,$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");n.isPasswordError=!1,$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")},n.uidCheck=function(){r.send("usermanagement","checkUid",n.uid,function(e){return JSON.parse(e).data?($("#uid").addClass("error-focus"),n.existID=!0):($("#uid").removeClass("error-focus"),n.existID=!1)})},n.apply=function(){if(""===$.trim(n.uid))return i("danger","Please input the text of 'User Id'",function(){$("#uid").removeClass("error-focus")}),void $("#uid").addClass("error-focus");if(n.existID)return i("danger","This id is exist.",function(){$("#uid").removeClass("error-focus")}),void $("#uid").addClass("error-focus");if(""===$.trim(n.given_name))return i("danger","Please input the text of 'Given name'",function(){$("#given_name").removeClass("error-focus")}),void $("#given_name").addClass("error-focus");if($("#given_name").removeClass("error-focus"),""===$.trim(n.name))return i("danger","Please input the text of 'name'",function(){$("#name").removeClass("error-focus")}),void $("#name").addClass("error-focus");if($("#name").removeClass("error-focus"),""===$.trim(n.nick_name))return i("danger","Please input the text of 'Nick name'",function(){$("#nick_name").removeClass("error-focus")}),void $("#nick_name").addClass("error-focus");$("#nick_name").removeClass("error-focus");if(""===$.trim(n.password))return i("danger","Please input the text of 'Password'",function(){$("#password").removeClass("error-focus")}),void $("#password").addClass("error-focus");if($("#password").removeClass("error-focus"),""===$.trim(n.password_confirm))return i("danger","Please input the text of 'Password confirm'",function(){$("#password_confirm").removeClass("error-focus")}),void $("#password_confirm").addClass("error-focus");if($("#password_confirm").removeClass("error-focus"),$.trim(n.password)!==$.trim(n.password_confirm))return i("danger","Please input the text of 'Password is incorrect'",function(){$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}),$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");if($("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus"),""===$.trim(n.company))return i("danger","Please select the value of 'company'",function(){$("#company").removeClass("error-focus")}),void $("#company").addClass("error-focus");if($("#company").removeClass("error-focus"),""===$.trim(n.group))return i("danger","Please select the value of 'group'",function(){$("#group").removeClass("error-focus")}),void $("#group").addClass("error-focus");$("#group").removeClass("error-focus"),0<n.img_blob.indexOf("no_photo.png")&&(n.img_blob=null);var e={uid:n.uid,given_name:n.given_name,name:n.name,nick_name:n.nick_name,img_blob:n.img_blob,password:n.password,company:n.company,group:n.group};a.show(),r.send("usermanagement","addUser",JSON.stringify(e),function(e){var o=JSON.parse(e);a.hide(),i(o.type,o.msg),"success"===o.type&&(n.reloadTable(),$("#profileModal").modal("hide"))})}}]),app.controller("useredit",["$scope","_ws","_loader","_safeApply","_extendModal","_filereader","_notification",function(n,r,a,t,i,o,s){a.controller.hide(),n.title="User Management",n.canCorrentPassword=!1,r.send("usermanagement","initEdit",n.selectid,function(e){var o=JSON.parse(e);n.given_name=o.given_name,null!==n.given_name&&$("#given_name_label").addClass("active"),n.name=o.name,null!==n.name&&$("#name_label").addClass("active"),n.nick_name=o.nick_name,null!==n.nick_name&&$("#nick_name_label").addClass("active"),null==o.img_blob?n.img_blob=CONTENTS+"no_photo.png":n.img_blob=o.img_blob,n.canModifyPassword=o.canModifyPassword,n.canModifyCompany=o.canModifyCompany,o.canModifyCompany&&(n.companyList=o.companyList,n.company=o.company,$(document).off("change","#company").on("change","#company",function(){t(function(){n.company=$("#company").val()}),n.canModifyGroup&&r.send("usermanagement","getGroup",JSON.stringify({key:Number(n.company)}),function(e){var o=JSON.parse(e);n.groupList=o.data,a.ready(function(){$(".mdb-select").material_select("destroy"),$(".mdb-select").material_select()})})})),n.canModifyGroup=o.canModifyGroup,o.canModifyGroup&&(n.groupList=o.groupList,n.group=o.group,$(document).off("change","#group").on("change","#group",function(){t(function(){n.group=$("#group").val()})})),a.ready(function(){o.canModifyCompany&&$("#company").val(o.company),o.canModifyGroup&&$("#group").val(o.group),$(".mdb-select").material_select(),$("#profileModal").modal("show"),$("#profileModal").on("hidden.bs.modal",function(){i.mainModal()})}),a.controller.show()}),n.checkPassword=function(){if($.trim(n.password)!==$.trim(n.password_confirm))return n.isPasswordError=!0,$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");n.isPasswordError=!1,$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")},n.fileupload=function(){var e=o.getFile($("#img_file"));e.size>CARD_FILE_SIZE_LIMIT?s("danger","The file maximum size has been exceeded. max-size : 60KB"):o.readFile(e,function(e){n.img_blob=e.binary})},n.apply=function(){if(""===$.trim(n.given_name))return s("danger","Please input the text of 'Given name'",function(){$("#given_name").removeClass("error-focus")}),void $("#given_name").addClass("error-focus");if($("#given_name").removeClass("error-focus"),""===$.trim(n.name))return s("danger","Please input the text of 'name'",function(){$("#name").removeClass("error-focus")}),void $("#name").addClass("error-focus");if($("#name").removeClass("error-focus"),""===$.trim(n.nick_name))return s("danger","Please input the text of 'Nick name'",function(){$("#nick_name").removeClass("error-focus")}),void $("#nick_name").addClass("error-focus");if($("#nick_name").removeClass("error-focus"),n.canModifyPassword){var e=!0;if(""===$.trim(n.current_password)&&(e=!1),""===$.trim(n.password)&&e)return s("danger","Please input the text of 'Password'",function(){$("#password").removeClass("error-focus")}),void $("#password").addClass("error-focus");if($("#password").removeClass("error-focus"),""===$.trim(n.password_confirm)&&e)return s("danger","Please input the text of 'Password confirm'",function(){$("#password_confirm").removeClass("error-focus")}),void $("#password_confirm").addClass("error-focus");if($("#password_confirm").removeClass("error-focus"),$.trim(n.password)!==$.trim(n.password_confirm)&&e)return s("danger","Please input the text of 'Password is incorrect'",function(){$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}),$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}if(n.canModifyCompany){if(""===$.trim(n.company))return s("danger","Please select the value of 'company'",function(){$("#company").removeClass("error-focus")}),void $("#company").addClass("error-focus");$("#company").removeClass("error-focus")}if(n.canModifyGroup){if(""===$.trim(n.group))return s("danger","Please select the value of 'group'",function(){$("#group").removeClass("error-focus")}),void $("#group").addClass("error-focus");$("#group").removeClass("error-focus")}0<n.img_blob.indexOf("no_photo.png")&&(n.img_blob=null);var o={uid:n.selectid,given_name:n.given_name,name:n.name,nick_name:n.nick_name,img_blob:n.img_blob,current_password:n.current_password,password:n.password,company:n.company,group:n.group};a.show(),r.send("usermanagement","applyEdit",JSON.stringify(o),function(e){var o=JSON.parse(e);a.hide(),s(o.type,o.msg),"success"===o.type&&(n.reloadTable(),$("#profileModal").modal("hide"))})}}]),app.controller("usermanagement",["$scope","_ws","_loader","_safeApply","_extendModal","_notification","_table",function(n,r,a,e,t,i,s){a.controller.hide(),r.send("usermanagement","init",null,function(e){var o=s({element:"#tablelist",url:JSON.parse(e).data,columns:["id","given_name","name","nick_name","company_name","group_name","type","active"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(i("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("id")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null}});n.userAdd=function(){t.mainModal("./views/profile.tpl.jsp","useradd",n)},n.userEdit=function(){t.mainModal("./views/profile.tpl.jsp","useredit",n)},n.userDelete=function(){a.show(),r.send("usermanagement","delete",n.selectid,function(e){var o=JSON.parse(e);a.hide(),i(o.type,o.msg),n.reloadTable(),$("#deleteModal").modal("hide")})},n.reloadTable=function(){o.ajax.reload()},a.controller.show()})}]),app.factory("_filereader",["$rootScope","_safeApply",function(e,n){return read=function(e,o){return node=new function(){return{reader:new FileReader,file:e}},node.reader.onload=function(e){node.binary=this.result,null==o||"function"!=typeof o||n(function(){o.call(this,node)})},node.reader.readAsDataURL(e),node},copyArray=function(e,o,n,r,a){for(var t=o,i=r;t<o+a;t++,i++)n[i]=e[t];return n},{getFile:function(e){return $(e)[0].files[0]},readFile:function(e,o){return read(e,o)}}}]),app.service("_loader",["$rootScope","_safeApply",function(e,o){return e.isController=!0,e.isLoader=!1,{show:function(){o(function(){e.isLoader=!0})},hide:function(){o(function(){e.isLoader=!1})},controller:{show:function(){o(function(){e.isController=!0,e.isLoader=!1})},hide:function(){o(function(){e.isController=!1,e.isLoader=!0})}},ready:function(e){e&&"function"==typeof e&&$(e)}}}]),app.service("_safeApply",["$rootScope",function(n){return function(e){var o=n.$$phase;"$apply"==o||"$digest"==o?util.isFunction(e)&&e.call(this):n.$apply(e)}}]),app.service("_notification",["$rootScope","$timeout","_safeApply",function(e,l,o){return function(t,i,s){o(function(){"success"!==t&&"warning"!==t&&(t="danger");var e=$("<span></span>");"danger"!==t&&"warning"!==t||e.append($("<i></i>").addClass("fa fa-warning")),e.append("&nbsp;"+t.toUpperCase());var o=$("<button></button>").addClass("close").append($("<span></span>").attr("aria-hidden","true").html("&times;")),n=$("<span></span>").css("display","block").append(e).append(o),r=$("<div></div>").addClass("alert alert-"+t).append(n).append($("<span></span>").addClass("glyphicon glyphicon-exclamation-sign").text(i)),a=$("<div></div>").addClass("notification-row").append(r);5<$("div.notification-row").length&&$("div.notification-row")[0].remove(),$(".notification-zone").append(a),l(function(){a.remove(),util.isFunction(s)&&s.call(this)},5e3)})}}]),app.service("_extendModal",["$rootScope","$http","$compile","$timeout",function(t,i,s,l){return{mainModal:function(e,n,r,a){if(void 0!==e)i.get(e).then(function(e){var o=$("#extendModal").attr("ng-controller",n).html(e.data);$(".content-wrapper").addClass("position-fix"),s(o)(null==r?t:r),util.isFunction(a)&&a.call(this)});else{$("#extendModal").attr("ng-controller","").html("");$(".content-wrapper").removeClass("position-fix")}},menuModal:function(e,n,r,a){var o=$("div.menu-backdrop");o.length<1?((o=$("<div></div>").addClass("menu-backdrop").addClass("fade").addClass("show")).on("click",function(){$(".menu.fade.top").removeClass("show"),$(".content-wrapper").removeClass("position-fix"),$("#menuFrame").attr("ng-controller","").html(""),$(this).remove()}),$("body").append(o)):$("#menuFrame").off("click"),i.get(e).then(function(e){var o=$("#menuFrame").attr("ng-controller",n).html(e.data);s(o)(null==r?t:r),l(function(){$(".content-wrapper").addClass("position-fix"),$(".menu.fade.top").addClass("show"),util.isFunction(a)&&a.call(this)},1),o.on("click",function(){$(".menu-backdrop").click()})})}}}]),app.service("_ws",["$rootScope","_safeApply",function(e,a){var o=new WebSocket(WS_HOST+"/socket"),s={open:null,close:null,error:[],message:[]},c=[];function t(e){for(var o=null,n=JSON.parse(e.data),r=0;r<c.length;r++)if(n.control===c[r].control&&n.action===c[r].action){o=c[r],c.splice(r,1);break}null!==o&&(a(function(){o.func.call(this,n.data)}),util.isFunction(o.cb)&&o.cb.call(this))}function n(e,o,n){util.isFunction(o)?s[e]={func:o,cb:n}:console.error("It's not defined because not function method.")}function i(e,o,n,r,a){if(util.isFunction(r)){for(var t in s[e]){var i=s[e][t];if(i.control===o&&i.action===n)return void(i.func=r)}s[e].push({control:o,action:n,func:r,cb:a,type:2})}else console.error("It's not defined because not function method.")}return o.onopen=function(e){null!==s.open&&(a(function(){s.open.func.call(this,e)}),util.isFunction(s.open.cb)&&s.open.cb.call(this))},o.onclose=function(e){null!==s.close&&(a(function(){s.close.func.call(this,e)}),util.isFunction(s.close.cb)&&s.close.cb.call(this))},o.onerror=function(e){t(e);for(var o=null,n=JSON.parse(e.data),r=0;r<s.error.length;r++)if(n.control===s.error[r].control&&n.action===s.error[r].action){o=s.error[r];break}null!==o&&(a(function(){o.func.call(this,n.data)}),util.isFunction(o.cb)&&o.cb.call(this))},o.onmessage=function(e){t(e);for(var o=null,n=JSON.parse(e.data),r=0;r<s.message.length;r++)if(n.control===s.message[r].control&&n.action===s.message[r].action){o=s.message[r];break}null!==o&&(a(function(){o.func.call(this,n.data)}),util.isFunction(o.cb)&&o.cb.call(this))},sendNode=function(e){if(1===o.readyState)try{o.send(e)}catch(e){console.log(e)}else setTimeout(function(){sendNode(e)},1e3)},{open:function(e,o){n("open",e,o)},close:function(e,o){n("close",e,o)},error:function(e,o,n,r){i("error",e,o,n,r)},message:function(e,o,n,r){i("message",e,o,n,r)},send:function(e,o,n,r,a){var t,i,s,l;null==n&&(n=""),n+="",util.isFunction(r)&&(t=e,i=o,s=r,l=a,util.isFunction(s)?c.push({control:t,action:i,func:s,cb:l}):console.error("It's not defined because not function method.")),sendNode(JSON.stringify({control:e,action:o,data:n}))}}}]),app.service("_table",["_safeApply",function(i){return function(a){var e={ajax:{url:a.url,type:"POST",complete:function(){util.isFunction(a.complete)&&a.complete.call(this)},error:function(e,o,n){util.isFunction(a.error)&&a.error.call(this,e,o,n)}},ordering:!1,select:{style:"single"},columnDefs:[{className:"control",targets:0,data:null,defaultContent:""}],responsive:{details:{type:"column",target:0}},columns:function(e){if(null==e)return null;var o=[{data:null}];for(var n in e)o.push({data:e[n]});return o}(a.columns)};void 0!==a.option&&(e=$.extend(e,a.option));var t=$(a.element).DataTable(e);return t.on("select",function(e,o,n,r){"row"===n&&i(function(){util.isFunction(a.select)&&a.select.call(this,t,r)})}),t.on("deselect",function(e,o,n,r){"row"===n&&i(function(){util.isFunction(a.deselect)&&a.deselect.call(this,t,r)})}),t}}]),app.service("_util",["_notification",function(r){return{validateInput:function(e,o,n){return""===$.trim(e)?(r("danger","Please input the text of '"+n+"'",function(){$(o).removeClass("error-focus")}),$(o).addClass("error-focus"),!1):($(o).removeClass("error-focus"),!0)}}}]);