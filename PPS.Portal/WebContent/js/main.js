var app=angular.module("app",["ngRoute","ngSanitize"]);app.config(["$routeProvider","$qProvider",function(e,o){e.when("/",{controller:"main",templateUrl:"./views/main.tpl.jsp"}).when("/cardmastersetting",{controller:"cardmastersetting",templateUrl:"./views/cardmastersetting.tpl.jsp"}).when("/cardviewrole",{controller:"cardviewrole",templateUrl:"./views/viewrole.tpl.jsp"}).when("/actionrole",{controller:"actionrole",templateUrl:"./views/viewrole.tpl.jsp"}).when("/comgroupsetting",{controller:"comgroupsetting",templateUrl:"./views/comgroupsetting.tpl.jsp"}).when("/usermanagement",{controller:"usermanagement",templateUrl:"./views/usermanagement.tpl.jsp"}).otherwise({redirectTo:"/"})}]),app.directive("navigation",function(){return{restrict:"A",template:"<li ng-repeat='n in navi'><a ng-click='menu(n.menu,n.control,n.template,n.href);'>{{n.name}}</a></li>"}}),app.directive("loader",function(){return{restrict:"A",template:"<div class='loader'></div>"}}),app.filter("trusted",["$sce",function(o){return function(e){return o.trustAsHtml(e)}}]),app.controller("actionrole",["$scope","_ws","_loader","_table",function(n,e,o,r){o.controller.hide(),n.title="Action role",e.send("actionrole","init",null,function(e){r({element:"#tablelist",url:JSON.parse(e).data,columns:["code","name"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(_notification("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("id")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null}});n.userAdd=function(){},n.userEdit=function(){},n.userDelete=function(){},o.controller.show()})}]),app.controller("admin",["$scope","_ws","_loader",function(o,e,n){n.show(),e.send("admin","init",null,function(e){o.cards=JSON.parse(e),n.hide()})}]),app.controller("card",["$scope","_ws","_loader",function(o,e,n){n.show(),e.send("card","init",null,function(e){o.cards=JSON.parse(e),n.hide()})}]),app.controller("cardmaster",["$scope","_ws","_loader","_safeApply","_filereader","_util","_extendModal","_notification",function(r,o,a,t,n,i,s,l){a.controller.hide(),o.send("cardmastersetting","initEdit",r.selectid,function(e){function o(){"IMC"===r.cardtype||"IMG"===r.cardtype?(r.isImageType=!0,r.isEventType=!1):"EMC"===r.cardtype||"EVT"===r.cardtype?(r.isImageType=!1,r.isEventType=!0):(r.isImageType=!1,r.isEventType=!1)}var n=JSON.parse(e);r.code=n.code,null!==r.code&&$("#code_label").addClass("active"),r.step=n.step,null!==r.step&&$("#step_label").addClass("active"),r.controller=n.controller,null!==r.controller&&$("#controler_label").addClass("active"),r.template=n.template,null!==r.template&&$("#template_label").addClass("active"),r.name=n.name,null!==r.name&&$("#name_label").addClass("active"),r.sequence=n.seq,null!==r.sequence&&$("#sequence_label").addClass("active"),r.description=n.description,null!==r.description&&$("#description_label").addClass("active"),r.cardtypeList=n.cardtypelist,r.cardtype=n.type,o(),$(document).off("change","#cardtype").on("change","#cardtype",function(){t(function(){r.cardtype=$("#cardtype").val(),o()})}),null==n.img?r.img_url=CONTENTS+"no_card.jpg":r.img_url=n.img,r.title=n.title,null!==r.title&&$("#title_label").addClass("active"),r.icon=n.icon,null!==r.icon&&$("#icon_label").addClass("active"),r.color=n.color,null!==r.color&&$("#color_label").addClass("active"),a.ready(function(){$("#cardtype").val(n.type),$(".mdb-select").material_select(),$("#cardMasterModal").modal("show"),$("#cardMasterModal").on("hidden.bs.modal",function(){s.mainModal()})}),a.controller.show()}),r.fileupload=function(){var e=n.getFile($("#img_file"));e.size>CARD_FILE_SIZE_LIMIT?l("danger","The file maximum size has been exceeded. max-size : 60KB"):n.readFile(e,function(e){r.img_url=e.binary})},r.apply=function(){if(i.validateInput(r.name,"#name","Name")&&i.validateInput(r.sequence,"#sequence","Sequence")){r.sequence=util.parseInt(r.sequence),r.img_url==CONTENTS+"no_card.jpg"&&(r.img_url=null);var e={code:r.code,name:r.name,seq:r.sequence,type:r.cardtype,title:r.title,icon:r.icon,color:r.color,img:r.img_url};a.show(),o.send("cardmastersetting","applyEdit",JSON.stringify(e),function(e){var o=JSON.parse(e);a.hide(),l(o.type,o.msg),r.reloadTable(),$("#cardMasterModal").modal("hide")})}}}]),app.controller("cardmastersetting",["$scope","_ws","_loader","_safeApply","_extendModal","_notification","_table",function(n,e,r,o,a,t,i){r.controller.hide(),e.send("cardmastersetting","init",null,function(e){var o=i({element:"#tablelist",url:JSON.parse(e).data,columns:["code","name","title","description","hasImg","icon","color","type","step","seq"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(t("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("code")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),n.selectid=null}});n.cardEdit=function(){a.mainModal("./views/cardmaster.tpl.jsp","cardmaster",n)},n.reloadTable=function(){o.ajax.reload()},r.controller.show()})}]),app.controller("cardviewrole",["$scope","_ws","_loader","_table",function(n,e,o,r){o.controller.hide(),n.title="View role",e.send("cardviewrole","init",null,function(e){r({element:"#tablelist",url:JSON.parse(e).data,columns:["code","name"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(_notification("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("id")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null}});n.userEdit=function(){},o.controller.show()})}]),app.controller("comgroupadd",["$scope","_ws","_loader","_extendModal","_safeApply","_notification",function(n,o,r,a,t,i){function s(e,o){if(null==e)return null;for(var n=0;n<e.length;n++)if(e[n].value===o)return e[n].name;return null}function l(e,o){if(null==e)return!1;for(var n=0;n<e.length;n++)if(e[n].name===o)return!0;return!1}r.show(),n.applyView=!0,n.dataCheck=function(e){e&&l(n.companyList,n.companyIn)&&(r.show(),o.send("comgroupsetting","getGroup",function(e,o){if(null==e)return null;for(var n=0;n<e.length;n++)if(e[n].name===o)return e[n].value;return null}(n.companyList,n.companyIn),function(e){var o=JSON.parse(e);n.groupList=o,$(document).off("change","#group").on("change","#group",function(){t(function(){n.group=$("#group").val(),n.groupIn=s(n.groupList,$("#group").val()),n.dataCheck(!1)})}),r.ready(function(){$(".mdb-select").material_select("destroy"),$(".mdb-select").material_select(),r.hide()})})),""===$.trim(n.companyIn)?n.applyView=!0:""===$.trim(n.groupIn)?n.applyView=!0:l(n.companyList,n.companyIn)&&l(n.groupList,n.groupIn)?n.applyView=!0:n.applyView=!1},n.apply=function(){return""===$.trim(n.companyIn)?(i("danger","Please input the text of company.",function(){$("#companyIn").removeClass("error-focus")}),void $("#companyIn").addClass("error-focus")):""===$.trim(n.groupIn)?(i("danger","Please input the text of group.",function(){$("#groupIn").removeClass("error-focus")}),void $("#groupIn").addClass("error-focus")):(r.show(),void o.send("comgroupsetting","applyAdd",JSON.stringify({company:n.companyIn,group:n.groupIn}),function(e){var o=JSON.parse(e);r.hide(),i(o.type,o.msg),"success"===o.type&&(n.reloadTable(),$("#comgroupModal").modal("hide"))}))},o.send("comgroupsetting","initAdd",null,function(e){var o=JSON.parse(e);n.companyList=o,$(document).off("change","#company").on("change","#company",function(){t(function(){n.company=$("#company").val(),n.companyIn=s(n.companyList,$("#company").val()),n.dataCheck(!0)})}),r.ready(function(){$(".mdb-select").material_select(),$("#comgroupModal").modal("show"),$("#comgroupModal").on("hidden.bs.modal",function(){a.mainModal()}),r.hide()})})}]),app.controller("comgroupedit",["$scope","_ws","_loader","_extendModal","_safeApply","_notification",function(n,e,r,a,o,t){r.show(),e.send("comgroupsetting","initEdit",n.selectid,function(e){var o=JSON.parse(e);n.companyIn=o.name,n.groupIn=o.groupname,n.editView=!0,r.ready(function(){$("#companyIn_label").addClass("active"),$("#groupIn_label").addClass("active"),$("#comgroupModal").modal("show"),$("#comgroupModal").on("hidden.bs.modal",function(){a.mainModal()}),r.hide()})}),n.edit=function(){return""===$.trim(n.companyIn)?(t("danger","Please input the text of company.",function(){$("#companyIn").removeClass("error-focus")}),void $("#companyIn").addClass("error-focus")):""===$.trim(n.groupIn)?(t("danger","Please input the text of group.",function(){$("#groupIn").removeClass("error-focus")}),void $("#groupIn").addClass("error-focus")):(r.show(),void e.send("comgroupsetting","applyEdit",JSON.stringify({id:n.selectid,company:n.companyIn,group:n.groupIn}),function(e){var o=JSON.parse(e);r.hide(),t(o.type,o.msg),"success"===o.type&&(n.reloadTable(),$("#comgroupModal").modal("hide"))}))}}]),app.controller("comgroupsetting",["$scope","_ws","_loader","_safeApply","_extendModal","_notification","_table",function(n,r,a,e,t,i,s){a.controller.hide(),r.send("comgroupsetting","init",null,function(e){var o=s({element:"#tablelist",url:JSON.parse(e).data,columns:["id","name","groupname","active"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(i("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("id")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null}});n.userAdd=function(){t.mainModal("./views/comgroupadd.tpl.jsp","comgroupadd",n)},n.userEdit=function(){t.mainModal("./views/comgroupedit.tpl.jsp","comgroupedit",n)},n.userDelete=function(){a.show(),r.send("comgroupsetting","delete",n.selectid,function(e){var o=JSON.parse(e);a.hide(),i(o.type,o.msg),n.reloadTable(),$("#deleteModal").modal("hide")})},n.reloadTable=function(){o.ajax.reload()},a.controller.show()})}]),app.controller("datamastersetting",["$scope","_ws","_loader","_notification",function(o,e,n,r){n.show(),e.send("datamastersetting","init",null,function(e){o.cards=JSON.parse(e),n.hide()})}]),app.controller("main",["$scope","_ws","_loader",function(e,o,n){n.controller.hide(),o.send("main","init",null,function(e){n.controller.show()})}]),app.controller("navigate",["$scope","_ws",function(o,e){e.message("navigate","init",function(e){o.navi=JSON.parse(e)})}]),app.controller("profile",["$scope","_ws","_notification","_filereader","_loader","_safeApply","_extendModal",function(n,r,a,o,t,i,s){t.controller.hide(),n.title="Profile",n.canUserId=!1,r.send("profile","init",null,function(e){var o=JSON.parse(e);n.given_name=o.given_name,null!==n.given_name&&$("#given_name_label").addClass("active"),n.name=o.name,null!==n.name&&$("#name_label").addClass("active"),n.nick_name=o.nick_name,null!==n.nick_name&&$("#nick_name_label").addClass("active"),o.is_img_blob?null==n.is_img_blob?(o.is_img_blob=!1,n.img_url=CONTENTS+"no_photo.png"):n.is_img_blob=!0:(n.is_img_blob=!1,null==n.img_url?n.img_url=CONTENTS+"no_photo.png":n.img_url=o.img_url),n.canCorrentPassword=o.canModifyPassword,n.canModifyPassword=o.canModifyPassword,n.canModifyCompany=o.canModifyCompany,o.canModifyCompany&&(n.companyList=o.companyList,n.company=o.company,$(document).off("change","#company").on("change","#company",function(){i(function(){n.company=$("#company").val()})})),n.canModifyGroup=o.canModifyGroup,o.canModifyGroup&&(n.groupList=o.groupList,n.group=o.group,$(document).off("change","#group").on("change","#group",function(){i(function(){n.group=$("#group").val()})})),t.ready(function(){o.canModifyCompany&&$("#company").val(o.company),o.canModifyGroup&&$("#group").val(o.group),$(".mdb-select").material_select(),$("#profileModal").modal("show"),$("#profileModal").on("hidden.bs.modal",function(){s.mainModal()})}),t.controller.show()}),r.message("profile","apply",function(e){var o=JSON.parse(e);t.hide(),a(o.type,o.msg)}),n.fileupload=function(){var e=o.getFile($("#img_file"));o.readFile(e,function(e){n.img_url=e.binary,n.is_img_blob=!0})},n.checkPassword=function(){if($.trim(n.password)!==$.trim(n.password_confirm))return n.isPasswordError=!0,$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");n.isPasswordError=!1,$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")},n.apply=function(){if(""===$.trim(n.given_name))return a("danger","Please input the text of 'Given name'",function(){$("#given_name").removeClass("error-focus")}),void $("#given_name").addClass("error-focus");if($("#given_name").removeClass("error-focus"),""===$.trim(n.name))return a("danger","Please input the text of 'name'",function(){$("#name").removeClass("error-focus")}),void $("#name").addClass("error-focus");if($("#name").removeClass("error-focus"),""===$.trim(n.nick_name))return a("danger","Please input the text of 'Nick name'",function(){$("#nick_name").removeClass("error-focus")}),void $("#nick_name").addClass("error-focus");if($("#nick_name").removeClass("error-focus"),n.canModifyPassword){var e=!0;if(""===$.trim(n.current_password)&&(e=!1),""===$.trim(n.password)&&e)return a("danger","Please input the text of 'Password'",function(){$("#password").removeClass("error-focus")}),void $("#password").addClass("error-focus");if($("#password").removeClass("error-focus"),""===$.trim(n.password_confirm)&&e)return a("danger","Please input the text of 'Password confirm'",function(){$("#password_confirm").removeClass("error-focus")}),void $("#password_confirm").addClass("error-focus");if($("#password_confirm").removeClass("error-focus"),$.trim(n.password)!==$.trim(n.password_confirm)&&e)return a("danger","Please input the text of 'Password is incorrect'",function(){$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}),$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}if(n.canModifyCompany){if(""===$.trim(n.company))return a("danger","Please select the value of 'company'",function(){$("#company").removeClass("error-focus")}),void $("#company").addClass("error-focus");$("#company").removeClass("error-focus")}if(n.canModifyGroup){if(""===$.trim(n.group))return a("danger","Please select the value of 'group'",function(){$("#group").removeClass("error-focus")}),void $("#group").addClass("error-focus");$("#group").removeClass("error-focus")}var o={given_name:n.given_name,name:n.name,nick_name:n.nick_name,img_url:n.img_url,is_img_blob:n.is_img_blob,current_password:n.current_password,password:n.password,company:n.company,group:n.group};t.show(),r.send("profile","apply",JSON.stringify(o))}}]),app.run(["$rootScope","_ws","_loader","_notification","_extendModal","$timeout","$http","$compile",function(e,o,n,r,a,t,i,s){o.message("login","init",function(e){"NG"===e&&(location.href="./Logout")}),o.message("login","permission",function(e){var o=JSON.parse(e);r(o.type,o.msg),location.href="./#!/"}),o.open(function(){}),o.close(function(){r("danger","The Websocket connection was lost."),t(function(){r("danger","It's reloading Now."),location.reload()},1e3,!0)}),e.profileEdit=function(){$("#navitoggler").click(),a.mainModal("./views/profile.tpl.jsp","profile",null,null)},e.menu=function(e,o,n,r){if(!e)return $(".menu-backdrop").click(),void(location.href=r);a.menuModal(n,o)}}]),app.controller("useradd",["$scope","_ws","_loader","_filereader","_safeApply","_notification",function(n,o,r,a,t,i){r.controller.hide(),n.title="User Management",n.canUserId=!0,n.canCorrentPassword=!1,n.canModifyPassword=!0,n.canModifyCompany=!0,n.canModifyGroup=!0,o.send("usermanagement","initAdd",null,function(e){var o=JSON.parse(e);n.img_url=CONTENTS+"no_photo.png",n.companyList=o.companyList,$(document).off("change","#company").on("change","#company",function(){t(function(){n.company=$("#company").val()})}),n.groupList=o.groupList,$(document).off("change","#group").on("change","#group",function(){t(function(){n.group=$("#group").val()})}),r.ready(function(){$(".mdb-select").material_select(),$("#profileModal").modal("show"),$("#profileModal").on("hidden.bs.modal",function(){_extendModal.mainModal()})}),r.controller.show()}),n.fileupload=function(){var e=a.getFile($("#img_file"));a.readFile(e,function(e){n.img_url=e.binary,n.is_img_blob=!0})},n.checkPassword=function(){if($.trim(n.password)!==$.trim(n.password_confirm))return n.isPasswordError=!0,$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");n.isPasswordError=!1,$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")},n.apply=function(){if(""===$.trim(n.uid))return i("danger","Please input the text of 'User Id'",function(){$("#uid").removeClass("error-focus")}),void $("#uid").addClass("error-focus");if(""===$.trim(n.given_name))return i("danger","Please input the text of 'Given name'",function(){$("#given_name").removeClass("error-focus")}),void $("#given_name").addClass("error-focus");if($("#given_name").removeClass("error-focus"),""===$.trim(n.name))return i("danger","Please input the text of 'name'",function(){$("#name").removeClass("error-focus")}),void $("#name").addClass("error-focus");if($("#name").removeClass("error-focus"),""===$.trim(n.nick_name))return i("danger","Please input the text of 'Nick name'",function(){$("#nick_name").removeClass("error-focus")}),void $("#nick_name").addClass("error-focus");$("#nick_name").removeClass("error-focus");if(""===$.trim(n.password))return i("danger","Please input the text of 'Password'",function(){$("#password").removeClass("error-focus")}),void $("#password").addClass("error-focus");if($("#password").removeClass("error-focus"),""===$.trim(n.password_confirm))return i("danger","Please input the text of 'Password confirm'",function(){$("#password_confirm").removeClass("error-focus")}),void $("#password_confirm").addClass("error-focus");if($("#password_confirm").removeClass("error-focus"),$.trim(n.password)!==$.trim(n.password_confirm))return i("danger","Please input the text of 'Password is incorrect'",function(){$("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus")}),$("#password").addClass("error-focus"),void $("#password_confirm").addClass("error-focus");if($("#password").removeClass("error-focus"),$("#password_confirm").removeClass("error-focus"),""===$.trim(n.company))return i("danger","Please select the value of 'company'",function(){$("#company").removeClass("error-focus")}),void $("#company").addClass("error-focus");if($("#company").removeClass("error-focus"),""===$.trim(n.group))return i("danger","Please select the value of 'group'",function(){$("#group").removeClass("error-focus")}),void $("#group").addClass("error-focus");$("#group").removeClass("error-focus");var e={uid:n.uid,given_name:n.given_name,name:n.name,nick_name:n.nick_name,img_url:n.img_url,is_img_blob:n.is_img_blob,password:n.password,company:n.company,group:n.group};r.show(),o.send("usermanagement","addUser",JSON.stringify(e),function(e){var o=JSON.parse(e);r.hide(),i(o.type,o.msg),location.href="./#!/usermanagement"})}}]),app.controller("useredit",["$scope","_ws","_loader","_safeApply","_extendModal",function(n,e,r,a,t){r.controller.hide(),n.title="User Management",n.canCorrentPassword=!1,e.send("usermanagement","initEdit",n.selectid,function(e){var o=JSON.parse(e);n.given_name=o.given_name,null!==n.given_name&&$("#given_name_label").addClass("active"),n.name=o.name,null!==n.name&&$("#name_label").addClass("active"),n.nick_name=o.nick_name,null!==n.nick_name&&$("#nick_name_label").addClass("active"),o.is_img_blob?null==n.is_img_blob?(o.is_img_blob=!1,n.img_url=CONTENTS+"no_photo.png"):n.is_img_blob=!0:(n.is_img_blob=!1,null==n.img_url?n.img_url=CONTENTS+"no_photo.png":n.img_url=o.img_url),n.canModifyPassword=o.canModifyPassword,n.canModifyCompany=o.canModifyCompany,o.canModifyCompany&&(n.companyList=o.companyList,n.company=o.company,$(document).off("change","#company").on("change","#company",function(){a(function(){n.company=$("#company").val()})})),n.canModifyGroup=o.canModifyGroup,o.canModifyGroup&&(n.groupList=o.groupList,n.group=o.group,$(document).off("change","#group").on("change","#group",function(){a(function(){n.group=$("#group").val()})})),r.ready(function(){o.canModifyCompany&&$("#company").val(o.company),o.canModifyGroup&&$("#group").val(o.group),$(".mdb-select").material_select(),$("#profileModal").modal("show"),$("#profileModal").on("hidden.bs.modal",function(){t.mainModal()})}),r.controller.show()})}]),app.controller("usermanagement",["$scope","_ws","_loader","_safeApply","_extendModal","_notification","_table",function(n,e,o,r,a,t,i){o.controller.hide(),e.send("usermanagement","init",null,function(e){i({element:"#tablelist",url:JSON.parse(e).data,columns:["id","given_name","name","nick_name","company_name","group_name","type","active"],complete:function(){$("#tablelist_wrapper").addClass("box-shadow-0"),$("#tablelist").css("width",""),$("#tablelist thead th").css("width","")},error:function(e,o,n){401===e.status&&(t("danger","You don't have permission."),location.href="./#!/")},select:function(e,o){$("#editbtn").prop("disabled",!1),$("#deletebtn").prop("disabled",!1),n.selectid=e.rows(o).data().pluck("id")[0]},deselect:function(e,o){$("#editbtn").prop("disabled",!0),$("#deletebtn").prop("disabled",!0),n.selectid=null}});n.userAdd=function(){a.mainModal("./views/profile.tpl.jsp","useradd",n)},n.userEdit=function(){a.mainModal("./views/profile.tpl.jsp","useredit",n)},n.userDelete=function(){},o.controller.show()})}]),app.factory("_filereader",["$rootScope","_safeApply",function(e,n){return read=function(e,o){return node=new function(){return{reader:new FileReader,file:e}},node.reader.onload=function(e){node.binary=this.result,null==o||"function"!=typeof o||n(function(){o.call(this,node)})},node.reader.readAsDataURL(e),node},copyArray=function(e,o,n,r,a){for(var t=o,i=r;t<o+a;t++,i++)n[i]=e[t];return n},{getFile:function(e){return $(e)[0].files[0]},readFile:function(e,o){return read(e,o)}}}]),app.service("_loader",["$rootScope","_safeApply",function(e,o){return e.isController=!0,e.isLoader=!1,{show:function(){o(function(){e.isLoader=!0})},hide:function(){o(function(){e.isLoader=!1})},controller:{show:function(){o(function(){e.isController=!0,e.isLoader=!1})},hide:function(){o(function(){e.isController=!1,e.isLoader=!0})}},ready:function(e){e&&"function"==typeof e&&$(e)}}}]),app.service("_safeApply",["$rootScope",function(n){return function(e){var o=n.$$phase;"$apply"==o||"$digest"==o?util.isFunction(e)&&e.call(this):n.$apply(e)}}]),app.service("_notification",["$rootScope","$timeout","_safeApply",function(e,l,o){return function(t,i,s){o(function(){"success"!==t&&"warning"!==t&&(t="danger");var e=$("<span></span>");"danger"!==t&&"warning"!==t||e.append($("<i></i>").addClass("fa fa-warning")),e.append("&nbsp;"+t.toUpperCase());var o=$("<button></button>").addClass("close").append($("<span></span>").attr("aria-hidden","true").html("&times;")),n=$("<span></span>").css("display","block").append(e).append(o),r=$("<div></div>").addClass("alert alert-"+t).append(n).append($("<span></span>").addClass("glyphicon glyphicon-exclamation-sign").text(i)),a=$("<div></div>").addClass("notification-row").append(r);5<$("div.notification-row").length&&$("div.notification-row")[0].remove(),$(".notification-zone").append(a),l(function(){a.remove(),util.isFunction(s)&&s.call(this)},5e3)})}}]),app.service("_extendModal",["$rootScope","$http","$compile","$timeout",function(t,i,s,l){return{mainModal:function(e,n,r,a){if(void 0!==e)i.get(e).then(function(e){var o=$("#extendModal").attr("ng-controller",n).html(e.data);$(".content-wrapper").addClass("position-fix"),s(o)(null==r?t:r),util.isFunction(a)&&a.call(this)});else{$("#extendModal").attr("ng-controller","").html("");$(".content-wrapper").removeClass("position-fix")}},menuModal:function(e,n,r,a){var o=$("div.menu-backdrop");o.length<1?((o=$("<div></div>").addClass("menu-backdrop").addClass("fade").addClass("show")).on("click",function(){$(".menu.fade.top").removeClass("show"),$(".content-wrapper").removeClass("position-fix"),$("#menuFrame").attr("ng-controller","").html(""),$(this).remove()}),$("body").append(o)):$("#menuFrame").off("click"),i.get(e).then(function(e){var o=$("#menuFrame").attr("ng-controller",n).html(e.data);s(o)(null==r?t:r),l(function(){$(".content-wrapper").addClass("position-fix"),$(".menu.fade.top").addClass("show"),util.isFunction(a)&&a.call(this)},1),o.on("click",function(){$(".menu-backdrop").click()})})}}}]),app.service("_ws",["$rootScope","_safeApply",function(e,a){var o=new WebSocket(WS_HOST+"/socket"),s={open:null,close:null,error:[],message:[]};function n(e,o,n){util.isFunction(o)?s[e]={func:o,cb:n}:console.error("It's not defined because not function method.")}function t(e,o,n,r,a){if(util.isFunction(r)){for(var t in s[e]){var i=s[e][t];if(i.control===o&&i.action===n)return void(i.func=r)}s[e].push({control:o,action:n,func:r,cb:a})}else console.error("It's not defined because not function method.")}return o.onopen=function(e){null!==s.open&&(a(function(){s.open.func.call(this,e)}),util.isFunction(s.open.cb)&&s.open.cb.call(this))},o.onclose=function(e){null!==s.close&&(a(function(){s.close.func.call(this,e)}),util.isFunction(s.close.cb)&&s.close.cb.call(this))},o.onerror=function(e){var o=null,n=JSON.parse(e.data);for(var r in s.error)if(n.control===s.error[r].control&&n.action===s.error[r].action){o=s.error[r];break}null!==o&&(a(function(){o.func.call(this,n.data)}),util.isFunction(o.cb)&&o.cb.call(this))},o.onmessage=function(e){var o=null,n=JSON.parse(e.data);for(var r in s.message)if(n.control===s.message[r].control&&n.action===s.message[r].action){o=s.message[r];break}null!==o&&(a(function(){o.func.call(this,n.data)}),util.isFunction(o.cb)&&o.cb.call(this))},sendNode=function(e){if(1===o.readyState)try{o.send(e)}catch(e){console.log(e)}else setTimeout(function(){sendNode(e)},1e3)},{open:function(e,o){n("open",e,o)},close:function(e,o){n("close",e,o)},error:function(e,o,n,r){t("error",e,o,n,r)},message:function(e,o,n,r){t("message",e,o,n,r)},send:function(e,o,n,r,a){null==n&&(n=""),util.isFunction(r)&&t("message",e,o,r,a),sendNode(JSON.stringify({control:e,action:o,data:n}))}}}]),app.service("_table",["_safeApply",function(i){return function(a){var t=$(a.element).DataTable({ajax:{url:a.url,type:"POST",complete:function(){util.isFunction(a.complete)&&a.complete.call(this)},error:function(e,o,n){util.isFunction(a.error)&&a.error.call(this,e,o,n)}},ordering:!1,select:{style:"single"},columnDefs:[{className:"control",targets:0,data:null,defaultContent:""}],responsive:{details:{type:"column",target:0}},columns:function(e){if(null==e)return null;var o=[{data:null}];for(var n in e)o.push({data:e[n]});return o}(a.columns)});return t.on("select",function(e,o,n,r){"row"===n&&i(function(){util.isFunction(a.select)&&a.select.call(this,t,r)})}),t.on("deselect",function(e,o,n,r){"row"===n&&i(function(){util.isFunction(a.deselect)&&a.deselect.call(this,t,r)})}),t}}]),app.service("_util",["_notification",function(r){return{validateInput:function(e,o,n){return""===$.trim(e)?(r("danger","Please input the text of '"+n+"'",function(){$(o).removeClass("error-focus")}),$(o).addClass("error-focus"),!1):($(o).removeClass("error-focus"),!0)}}}]);